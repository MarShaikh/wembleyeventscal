<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wembley Events Calendar</title>
    <style>
        :root {
            --primary-color: #ff90e8;
            --secondary-color: #000000;
            --background-color: #ffffff;
            --text-color: #000000;
            --card-background: #f2f2f2;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        h1, h2 {
            color: var(--secondary-color);
            font-weight: 700;
        }
        h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        h2 {
            font-size: 2rem;
            margin-top: 2rem;
        }
        p {
            font-size: 1.1rem;
            max-width: 600px;
            margin-bottom: 2rem;
        }
        .button {
            background-color: var(--primary-color);
            color: var(--secondary-color);
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            margin: 0 10px 10px 0;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }
        .button:hover {
            background-color: #ff70d8;
        }
        #eventList {
            list-style-type: none;
            padding: 0;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        #eventList li {
            background-color: var(--card-background);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        #eventList li:hover {
            transform: translateY(-5px);
        }
        img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        #loading {
            text-align: center;
            display: none;
            font-size: 1.2rem;
            margin-top: 2rem;
        }
        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            h1 {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Wembley Events Calendar</h1>
        <p>Instead of opening the <a href="https://www.wembleystadium.com/events">main website</a>, add the events directly to your calendar to easily plan things around. It is easy, just click the button and open the file, the dates will automatically be added to your calendar! </p>
        <button class="button" onclick="downloadICS()">Add to calendar</button>
        <h2>Upcoming Events:</h2>
        <div id="loading">Loading events...</div>
        <ul id="eventList"></ul>
    </div>

    <script>
        let events = [];

        async function fetchEvents() {
            const loading = document.getElementById('loading');
            loading.style.display = 'block';

            try {
                const response = await fetch('https://marshaikh.pythonanywhere.com/api/events');
                events = await response.json();
                populateEventList();
            } catch (error) {
                console.error('Error fetching events:', error);
                document.getElementById('eventList').innerHTML = '<li>Failed to load events. Please try again later.</li>';
            } finally {
                loading.style.display = 'none';
            }
        }

        function populateEventList() {
            const eventList = document.getElementById('eventList');
            eventList.innerHTML = '';
            events.forEach(event => {
                const li = document.createElement('li');
                const date = new Date(event.date);
                li.innerHTML = `
                    <h3>${event.name}</h3>
                    <p>${date.toLocaleDateString()}</p>
                `;
                eventList.appendChild(li);
            });
        }

        function downloadICS() {
            let icsContent = "BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Wembley Stadium//EN\n";
            events.forEach(event => {
                const date = new Date(event.date);
                const endDate = new Date(date.getTime() + 2 * 60 * 60 * 1000);
                icsContent += "BEGIN:VEVENT\n";
                icsContent += `DTSTART:${date.toISOString().replace(/[-:]/g, '').replace(/\.\d{3}/, '')}\n`;
                icsContent += `DTEND:${endDate.toISOString().replace(/[-:]/g, '').replace(/\.\d{3}/, '')}\n`;
                icsContent += `SUMMARY:${event.name}\n`;
                icsContent += "LOCATION:Wembley Stadium, London\n";
                icsContent += "END:VEVENT\n";
            });
            icsContent += "END:VCALENDAR";

            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'wembley_events.ics';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        fetchEvents();
    </script>
</body>
</html>